summary: "Endpoint for Random Forest Model Training (Multiclass: LOITERING, NORMAL, STOPPING, TRANSSHIPMENT)"
description: |
  Trains a Random Forest classifier to discriminate among **LOITERING**, **NORMAL**, **STOPPING**, and **TRANSSHIPMENT**.
  All features come from the `captaima.aggregated_ais_data` table. Training metadata and metrics are logged to MLflow.

tags:
  - "Train Machine Learning Models"
produces:
  - "application/json"
parameters:
  - in: body
    name: body
    description: |
      Pass hyperparameters to customize training:

      - **per_label_n**: number of samples per class (defaults to minimum class size among the four labels).
      - **n_estimators**: number of trees.
      - **max_depth**: maximum tree depth.
      - **test_size**: fraction of data reserved for test.
      - **random_state**: seed for reproducibility.
      - **experiment_name**: name of MLflow experiment.

    required: true
    schema:
      type: object
      properties:
        experiment_name:
          type: string
          example: "TransshipmentMulticlassExperiment"
        hyperparameters:
          type: object
          properties:
            per_label_n:
              type: integer
              example: 200
            n_estimators:
              type: integer
              example: 200
            max_depth:
              type: integer
              example: null
            test_size:
              type: number
              format: float
              example: 0.20
            random_state:
              type: integer
              example: 42

responses:
  200:
    description: Training completed; returns metrics and mlflow run id.
    schema:
      type: object
      properties:
        accuracy:
          type: number
        f1:
          type: number
        precision:
          type: number
        recall:
          type: number
        mlflow_run_id:
          type: string
  500:
    description: Internal Server Error
    schema:
      type: object
      properties:
        error:
          type: string
        details:
          type: string
